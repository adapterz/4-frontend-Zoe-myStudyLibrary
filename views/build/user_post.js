const BACKEND_URL="http://localhost:13414";const FRONT_URL="http://localhost:37866";const GET="GET";const POST="POST";const PATCH="PATCH";const DELETE="DELETE";const OK=200;const CREATED=201;const NO_CONTENT=204;const BAD_REQUEST=400;const UNAUTHORIZED=401;const FORBIDDEN=403;const NOT_FOUND=404;const CONFLICT=409;const INTERNAL_SERVER_ERROR=500;const FAIL_FETCH="fail_fetch";const REQUEST_SUCCESS="request_success";const LOGIN_REQUIRED="login_required";const LOGIN="login";const ALREADY_LOGIN="already_login";const LOGOUT="logout";const SIGN_UP="sign_up";const INVALID_BODY="invalid_body";const PW_MISMATCHED="pw_mismatched";const NEW_PW_CONFIRM_MISMATCHED="pw/pw_confirm_mismatched";const ONLY_IMAGE="only_jpg,jpeg,gjf,png(upper_5MB)_format_can_be_uploaded";const DUPLICATED_NICKNAME="duplicated_nickname";const NOT_EXIST="not_exist";const NO_COMMENT="no_comment";const FAVORITE="favorite +1";const CANCEL_FAVORITE="cancel_favorite";const NOT_AUTHORIZATION="not_authorization";const NO_REGISTERED_INFORMATION="no_registered_information";const INFO="info";const ERROR="error";const SUCCESS="success";const WARNING="warning";const QUESTION="question";const CHECK="check";async function getSignUpGuide(){try{const t={mode:"cors",credentials:"include"};const e=await fetch(`${BACKEND_URL}/user/sign-up/guide`,t);const o=e.status;if(o===OK){const t=await e.text();return t}else return await e.json()}catch(t){console.log(`FETCH ERROR: ${t}`);return{state:FAIL_FETCH}}}async function signUpRequest(t,e,o,s,n,r,c){try{const a={mode:"cors",method:POST,credentials:"include",headers:{"Content-Type":"application/json;charset=utf-8","Access-Control-Allow-Headers":"Content-Type, Referrer-Policy","Referrer-Policy":"strict-origin-when-cross-origin"},body:JSON.stringify({id:t,pw:e,confirmPw:o,name:s,nickname:n,phoneNumber:r,gender:c})};const i=await fetch(`${BACKEND_URL}/user/sign-up`,a);const l=await i.json();return l}catch(t){console.log(`FETCH ERROR: ${t}`);return{state:FAIL_FETCH}}}async function dropOutRequest(){try{const t={mode:"cors",method:DELETE,credentials:"include",headers:{"Access-Control-Allow-Headers":" Referrer-Policy","Referrer-Policy":"strict-origin-when-cross-origin"}};const e=await fetch(`${BACKEND_URL}/user/drop-out`,t);if(e.status===NO_CONTENT)return{state:REQUEST_SUCCESS};const o=await e.json();return o}catch(t){console.log(`FETCH ERROR: ${t}`);return{state:FAIL_FETCH}}}async function loginRequest(t,e){try{const o={mode:"cors",method:POST,credentials:"include",headers:{"Content-Type":"application/json;charset=utf-8","Access-Control-Allow-Headers":"Content-Type"},body:JSON.stringify({id:t,pw:e})};const s=await fetch(`${BACKEND_URL}/user/login`,o);const n=await s.json();return n}catch(t){console.log(`FETCH ERROR: ${t}`);return{state:FAIL_FETCH}}}async function logoutRequest(){try{const t={mode:"cors",method:POST,credentials:"include"};const e=await fetch(`${BACKEND_URL}/user/logout`,t);const o=await e.json();return o}catch(t){console.log(`FETCH ERROR: ${t}`);return{state:FAIL_FETCH}}}async function getUserLibrary(){try{const t={mode:"cors",credentials:"include"};const e=await fetch(`${BACKEND_URL}/user/user-lib`,t);const o=await e.json();return o}catch(t){console.log(`FETCH ERROR: ${t}`);return{state:FAIL_FETCH}}}async function reqRegisterUserLibrary(t){try{const e={mode:"cors",method:PATCH,credentials:"include"};const o=await fetch(`${BACKEND_URL}/user/user-lib?libraryIndex=${t}`,e);const s=o.status;if(s===OK)return{state:REQUEST_SUCCESS};const n=await o.json();return n}catch(t){console.log(`FETCH ERROR: ${t}`);return{state:FAIL_FETCH}}}async function deleteUserLibrary(t){try{const e={mode:"cors",method:DELETE,credentials:"include"};const o=await fetch(`${BACKEND_URL}/user/user-lib?libraryIndex=${t}`,e);const s=await o.json();return s}catch(t){console.log(`FETCH ERROR: ${t}`);return{state:FAIL_FETCH}}}async function editNicknameRequest(t){try{const e={mode:"cors",method:PATCH,credentials:"include",headers:{"Content-Type":"application/json;charset=utf-8","Access-Control-Allow-Headers":"Content-Type, Referrer-Policy","Referrer-Policy":"strict-origin-when-cross-origin"},body:JSON.stringify({nickname:t})};const o=await fetch(`${BACKEND_URL}/user/profile/nickname`,e);const s=o.status;if(s===OK)return{state:REQUEST_SUCCESS};const n=await o.json();return n}catch(t){console.log(`FETCH ERROR: ${t}`);return{state:FAIL_FETCH}}}async function editProfileImageRequest(t){try{const e={mode:"cors",method:PATCH,credentials:"include",body:t};const o=await fetch(`${BACKEND_URL}/user/profile/profileImage`,e);const s=o.status;if(s===OK)return{state:REQUEST_SUCCESS};const n=await o.json();return n}catch(t){console.log(`FETCH ERROR: ${t}`);return{state:FAIL_FETCH}}}async function editContactRequest(t){try{const e={mode:"cors",method:PATCH,credentials:"include",headers:{"Content-Type":"application/json;charset=utf-8","Access-Control-Allow-Headers":"Content-Type, Referrer-Policy","Referrer-Policy":"strict-origin-when-cross-origin"},body:JSON.stringify({phoneNumber:t})};const o=await fetch(`${BACKEND_URL}/user/new-contact`,e);const s=o.status;if(s===OK)return{state:REQUEST_SUCCESS};const n=await o.json();return n}catch(t){console.log(`FETCH ERROR: ${t}`);return{state:FAIL_FETCH}}}async function editPwRequest(t,e,o){try{const s={mode:"cors",method:PATCH,credentials:"include",headers:{"Content-Type":"application/json;charset=utf-8","Access-Control-Allow-Headers":"Content-Type, Referrer-Policy","Referrer-Policy":"strict-origin-when-cross-origin"},body:JSON.stringify({pw:t,newPw:e,confirmPw:o})};const n=await fetch(`${BACKEND_URL}/user/new-pw`,s);const r=n.status;if(r===OK)return{state:REQUEST_SUCCESS};const c=await n.json();return c}catch(t){console.log(`FETCH ERROR: ${t}`);return{state:FAIL_FETCH}}}async function getUserInfo(){try{const t={mode:"cors",credentials:"include"};const e=await fetch(`${BACKEND_URL}/user/info`,t);const o=await e.json();return o}catch(t){console.log(`FETCH ERROR: ${t}`);return{state:FAIL_FETCH}}}async function getRecentBoard(){try{const t={mode:"cors",credentials:"include"};const e=await fetch(`${BACKEND_URL}/board/get`,t);const o=await e.json();if(e.status===OK)return o[0];return o}catch(t){console.log(`FETCH ERROR: ${t}`);return{state:FAIL_FETCH}}}async function getEntireBoard(t){try{let e;const o={mode:"cors",credentials:"include"};if(void 0===t)e=await fetch(`${BACKEND_URL}/board/get/free-bulletin`,o);else e=await fetch(`${BACKEND_URL}/board/get/free-bulletin?page=${t}`,o);const s=await e.json();return s}catch(t){console.log(`FETCH ERROR: ${t}`);return{state:FAIL_FETCH}}}async function getDetailBoard(t){try{const e={mode:"cors",credentials:"include"};const o=await fetch(`${BACKEND_URL}/board/get/free-bulletin/${t}`,e);const s=await o.json();if(o.status===OK)s.state=REQUEST_SUCCESS;return s}catch(t){console.log(`FETCH ERROR: ${t}`);return{state:FAIL_FETCH}}}async function writePostRequest(t,e,o){try{const s=[];const n=o.split("#");n.shift();for(let t of n){const e={content:t};s.push(e)}const r={mode:"cors",method:POST,credentials:"include",headers:{"Content-Type":"application/json;charset=utf-8","Access-Control-Allow-Headers":"Content-Type, Referrer-Policy","Referrer-Policy":"strict-origin-when-cross-origin"},body:JSON.stringify({category:"자유게시판",postTitle:t,postContent:e,tags:s})};const c=await fetch(`${BACKEND_URL}/board/write`,r);const a=c.status;if(a===CREATED)return{state:REQUEST_SUCCESS};const i=await c.json();return i}catch(t){console.log(`FETCH ERROR: ${t}`);return{state:FAIL_FETCH}}}async function getPostRequest(t){try{const e={mode:"cors",method:GET,credentials:"include"};const o=await fetch(`${BACKEND_URL}/board/write?boardIndex=${t}`,e);const s=await o.json();if(o.status===OK)s.state=REQUEST_SUCCESS;return s}catch(t){console.log(`FETCH ERROR: ${t}`);return{state:FAIL_FETCH}}}async function editPostRequest(t,e,o,s){try{const n=[];const r=s.split("#");r.shift();for(let t of r){const e={content:t};n.push(e)}const c={mode:"cors",method:PATCH,credentials:"include",headers:{"Content-Type":"application/json;charset=utf-8","Access-Control-Allow-Headers":"Content-Type, Referrer-Policy","Referrer-Policy":"strict-origin-when-cross-origin"},body:JSON.stringify({category:"자유게시판",postTitle:e,postContent:o,tags:n})};const a=await fetch(`${BACKEND_URL}/board/edit?boardIndex=${t}`,c);if(a.status===OK)return{state:REQUEST_SUCCESS};const i=a.json();return i}catch(t){console.log(`FETCH ERROR: ${t}`);return{state:FAIL_FETCH}}}async function deletePostRequest(t){try{const e={mode:"cors",method:DELETE,credentials:"include"};const o=await fetch(`${BACKEND_URL}/board/delete?boardIndex=${t}`,e);const s=o.status;if(s===NO_CONTENT)return{state:REQUEST_SUCCESS};const n=await o.json();return n}catch(t){console.log(`FETCH ERROR: ${t}`);return{state:FAIL_FETCH}}}async function favoritePostRequest(t){try{const e={mode:"cors",method:PATCH,credentials:"include"};const o=await fetch(`${BACKEND_URL}/board/like?boardIndex=${t}`,e);const s=o.json();return s}catch(t){console.log(`FETCH ERROR: ${t}`);return{state:FAIL_FETCH}}}async function getSearchBoard(t,e,o){try{let s;const n={mode:"cors",method:GET,credentials:"include"};if(void 0===o)s=await fetch(`${BACKEND_URL}/board/search/free-bulletin?searchOption=${t}&searchContent=${e}`,n);else s=await fetch(`${BACKEND_URL}/board/search/free-bulletin?searchOption=${t}&searchContent=${e}&page=${o}`,n);const r=s.json();return r}catch(t){console.log(`FETCH ERROR: ${t}`);return{state:FAIL_FETCH}}}async function userPostRequest(t){try{let e;const o={mode:"cors",method:GET,credentials:"include"};if(void 0===t)e=await fetch(`${BACKEND_URL}/board/user`,o);else e=await fetch(`${BACKEND_URL}/board/user?page=${t}`,o);const s=e.json();return s}catch(t){console.log(`FETCH ERROR: ${t}`);return{state:FAIL_FETCH}}}async function sweetAlert(t,e,o,s){let n=!1;if(t===INFO){const t=await Swal.fire({title:e,text:o,icon:"info",confirmButtonColor:"#ffa07a"});if(t.isConfirmed||t.isDismissed)n=!0;return n}else if(t===SUCCESS){const t=await Swal.fire({title:e,text:o,icon:"success",confirmButtonColor:"#ffa07a"});if(t.isConfirmed||t.isDismissed)n=!0;return n}else if(t===WARNING)if(s){const t=await Swal.fire({title:e,text:o,icon:"warning",confirmButtonColor:"#ffa07a",footer:s});if(t.isConfirmed||t.isDismissed)n=!0;return n}else{const t=await Swal.fire({title:e,text:o,icon:"warning",confirmButtonColor:"#ffa07a"});if(t.isConfirmed||t.isDismissed)n=!0;return n}else if(t===ERROR)if(s){const t=await Swal.fire({title:e,text:o,icon:"error",confirmButtonColor:"#ffa07a",footer:s});if(t.isConfirmed||t.isDismissed)n=!0;return n}else{const t=await Swal.fire({title:e,text:o,icon:"error",confirmButtonColor:"#ffa07a"});if(t.isConfirmed||t.isDismissed)n=!0;return n}else if(t===QUESTION){const t=await Swal.fire({title:e,text:o,icon:"question",confirmButtonColor:"#ffa07a"});if(t.isConfirmed||t.isDismissed)n=!0;return n}else if(t===CHECK){const t=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:t=>{t.addEventListener("mouseenter",Swal.stopTimer);t.addEventListener("mouseleave",Swal.resumeTimer)}});t.fire({icon:o,title:e})}}let t=2;async function userPost(){const t=await userPostRequest();if(t.state===LOGIN_REQUIRED){const t=await sweetAlert(WARNING,"로그인 필요","로그인이 필요한 기능입니다.");if(t){const t="/user/login";location.href=t}}else if(t.state===NO_REGISTERED_INFORMATION){const t=document.createElement("li");t.classList.add("userResource--board__list");document.getElementsByClassName("userResource__board--container")[0].appendChild(t);const e=document.createElement("p");e.classList.add("userResource__board--title");e.textContent="작성한 글이 없습니다.";document.getElementsByClassName("userResource--board__list")[0].appendChild(e)}else if(void 0!==t[0])for(let e of t){const{boardIndex:t,postTitle:o,viewCount:s,favoriteCount:n,createDate:r}=e;await addPost(o,s,n,r,t)}else{const e=await sweetAlert(ERROR,"작성한 글 불러오기 실패","예상치 못한 오류입니다."`서버 메세지: ${t.state}`);if(e)location.href="/"}}async function addPost(t,e,o,s,n){const r=document.createElement("li");r.classList.add("userResource__board--list");document.getElementsByClassName("userResource__board--container")[0].appendChild(r);const c=document.getElementsByClassName("userResource__board--list").length-1;const a=document.createElement("a");a.classList.add("userResource__board--href");a.setAttribute("href",`/board/${n}`);document.getElementsByClassName("userResource__board--list")[c].appendChild(a);const i=document.createElement("p");i.classList.add("userResource__board--title");i.textContent=`${t}`;const l=document.createElement("p");l.classList.add("userResource__board--viewCount");l.innerHTML=`\n              <img className="userResouce__board--img" width="17px",height="17px" src="/views/img/view.png" alt="조회수 아이콘" /> ${e}`;const u=document.createElement("p");u.classList.add("userResource__board--favoriteCount");u.innerHTML=`\n              <img className="userResource__board--img" width="17px",height="17px" src="/views/img/love.png" alt="조회수 아이콘" /> ${o}`;const d=document.createElement("p");d.classList.add("userResource__board--createDate");d.textContent=`${s}`;const f=document.createElement("button");f.classList.add("button__userResource--delete");f.setAttribute("boardIndex",n);f.setAttribute("onclick","deletePost(this.getAttribute('boardIndex'))");f.innerHTML="삭제";document.getElementsByClassName("userResource__board--href")[c].append(i);document.getElementsByClassName("userResource__board--href")[c].append(l);document.getElementsByClassName("userResource__board--href")[c].append(u);document.getElementsByClassName("userResource__board--href")[c].append(d);document.getElementsByClassName("userResource__board--list")[c].append(f)}async function deletePost(t){const e=await deletePostRequest(t);if(e.state===LOGIN_REQUIRED){const t=await sweetAlert(WARNING,"로그인 필요","로그인창으로갑니다.");if(t)location.href="/user/login"}else if(e.state===NOT_EXIST){const t=await sweetAlert(WARNING,"존재하지 않는 게시글입니다.","삭제되거나 존재하지 않는 게시글입니다.");if(t)location.href="/board/user"}else if(e.state===NOT_AUTHORIZATION){const t=await sweetAlert(WARNING,"권한이 없습니다.","해당 게시글을 작성한 유저가 아닙니다.");if(t)location.href="/"}else if(e.state===REQUEST_SUCCESS){const t=await sweetAlert(SUCCESS,"게시글 삭제 성공","😇");if(t)location.href="/board"}else{const t=await sweetAlert(ERROR,"게시물 삭제 오류","게시글 목록으로 돌아갑니다.",`서버 메세지: ${e.state}`);if(t)location.href="/board"}}async function lifeCycle(){await userPost();window.onscroll=async function(){if(window.innerHeight+window.scrollY>=document.body.offsetHeight-1){const e=await userPostRequest(t++);if(e.state===LOGIN_REQUIRED){const t=await sweetAlert(WARNING,"로그인 필요","로그인이 필요한 기능입니다.");if(t){const t="/user/login";location.href=t}}else if(void 0!==e[0])for(let t of e){const{boardIndex:e,postTitle:o,viewCount:s,favoriteCount:n,createDate:r}=t;await addPost(o,s,n,r,e)}else if(e.state!==NO_REGISTERED_INFORMATION){const t=await sweetAlert(ERROR,"작성한 글 불러오기 실패","예상치 못한 오류입니다."`서버 메세지: ${e.state}`);if(t)location.href="/"}}}}lifeCycle();