<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <script src="/data/constant.js"></script>
    <script src="/data/user.js" type="text/javascript"></script>
    <script src="/data/board.js" type="text/javascript"></script>
    <script src="/data/wise_saying.js" type="text/javascript"></script>
    <style>
      @import url("/views/css/reset.css");
      @import url("/views/css/common.css");
      @import url("/views/css/home.css");
      /* 글씨체 */
      @import url("https://fonts.googleapis.com/css2?family=Grape+Nuts&family=Gugi&family=Lobster&family=Noto+Sans+KR:wght@300&family=Noto+Serif+KR&family=Poor+Story&display=swap");
    </style>
    <script>
      // 로그인 체크 필요(최초 한번 체크)
      async function checkLogin() {
        const result = await getUserInfo();
        // 로그인 안했을 때 로그인 창 있는 홈페이지로
        if (result.state === LOGIN_REQUIRED) {
          location.href = "/";
        }
      }
      checkLogin();
      // 버튼 메서드 정의
      // 로그아웃
      async function logout() {
        const result = await logoutRequest();
        if (result.state === LOGOUT) {
          location.href = "/";
        }
        alert(result.state);
      }

      // 데이터 가져오기(최초 1회)
      async function page() {
        // 최근 게시판 정보
        const boardResult = await getRecentBoard();
        // 최근 게시판 정보 파싱
        for (let num in boardResult) {
          document.getElementsByClassName("home__board--title")[num].innerHTML = `${boardResult[num].postTitle}`;
          document.getElementsByClassName("home__board--nickname")[
            num
          ].innerHTML = `작성자: ${boardResult[num].nickname}`;
        }
        // 명언 정보
        const wiseSayingResult = await getWiseSaying();
        // 명언 정보 파싱
        document.getElementsByClassName("home__wiseSaying--content")[0].innerHTML = wiseSayingResult.wiseSayingContent;
        document.getElementsByClassName("home__wiseSaying--celebrity")[0].innerHTML = wiseSayingResult.celebrity;

        // 유저 정보
        const userResult = await getUserInfo();
        document.getElementsByClassName("home__user--nickname")[0].innerHTML = `${userResult.nickname}님`;
        // 등록된 프로필 사진이 있을 때 프로필 사진 정보 주기
        if (userResult.isProfileImage) {
          const image = userResult.profileImage;
          const mime = userResult.mime;
          const imageHTML = document.getElementsByClassName("home__user--profileImage")[0];
          imageHTML.innerHTML = `<img class="home__user--profileImageImg" src="data:${mime};base64,${image} ">`;
        }
      }
      page();
    </script>
    <title>myStudyLibrary 홈페이지</title>
  </head>
  <body>
    <!-- 맨 위에 메뉴바 -->
    <nav class="gmb">
      <!-- 로고 -->
      <a href="/">
        <div class="gmb__logo">
          <img class="gmb__logo--img" src="/views/img/logo.png" alt="서비스 로고입니다." />
          myStudyLibrary
        </div>
      </a>
      <!-- 메뉴 -->
      <ul class="gmb__menu">
        <li><a href="">주변도서관</a></li>
        <li><a href="">자유게시판</a></li>
        <li><a href="">내가작성한글</a></li>
      </ul>
    </nav>
    <main class="home">
      <!-- 배경사진 -->
      <section class="home__card">
        <img class="home__card--img" src="/views/img/home.png" alt="홈페이지 메인 배경화면입니다." />
      </section>
      <!-- 유저 정보 -->
      <section class="home__user--logined">
        <!-- 유저가 사진등록안했을 때 -->
        <p class="home__user--profileImage">
          <img class="home__user--profileImageImg" src="/views/img/none_registered.png" alt="유저 사진입니다." />
        </p>
        <p class="home__user--nickname">유저 닉네임</p>
        <button type="button" class="button__user" onclick="location.href='/user/info'">유저정보</button>
        <button type="button" class="button__logout" onclick="logout()">로그아웃</button>
      </section>
      <!-- 자유게시판-최근게시글 -->
      <article class="home__board">
        <p class="home__category">📋 자유게시판 - 최신글</p>
        <nav>
          <li>
            <a href=""
              ><p class="home__board--title">글을 작성해주세요!</p>
              <p class="home__board--nickname">글이 작성되지 않았어요 :)</p></a
            >
          </li>
          <li>
            <a href=""
              ><p class="home__board--title">글을 작성해주세요!</p>
              <p class="home__board--nickname">글이 작성되지 않았어요 :)</p></a
            >
          </li>
          <li>
            <a href=""
              ><p class="home__board--title">글을 작성해주세요!</p>
              <p class="home__board--nickname">글이 작성되지 않았어요 :)</p></a
            >
          </li>
          <li>
            <a href=""
              ><p class="home__board--title">글을 작성해주세요!</p>
              <p class="home__board--nickname">글이 작성되지 않았어요 :)</p></a
            >
          </li>
          <li>
            <a href=""
              ><p class="home__board--title">글을 작성해주세요!</p>
              <p class="home__board--nickname">글이 작성되지 않았어요 :)</p></a
            >
          </li>
        </nav>
      </article>
      <!-- 동기부여용 명언 -->
      <article class="home__wiseSaying">
        <nav>
          <p class="home__category">💪 동기부여</p>
          <li class="home__wiseSaying--content">
            명언 예시
          </li>
          <li class="home__wiseSaying--celebrity">- Zoe -</li>
        </nav>
      </article>
    </main>
    <!-- footer -->
    <footer class="footer__serviceInfo">
      (주) myStudyLibrary
      <br />
      <pre> 대표: 김예지</pre>
      <br />
    </footer>
  </body>
</html>
